<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RialoSwap — Solana DEX</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

<!-- ✅ Jupiter Plugin v1 — Official latest CDN (replaces old terminal/main-v3.js) -->
<script src="https://plugin.jup.ag/plugin-v1.js" data-preload defer></script>

<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#060b12;--card:#0d1520;--border:rgba(0,220,180,0.12);
  --accent:#00dcb4;--accent2:#00ffe0;--red:#ff4560;
  --text:#dff0ec;--muted:rgba(200,230,220,0.4);
  --font:'Syne',sans-serif;--mono:'DM Mono',monospace;
}
body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:linear-gradient(rgba(0,220,180,0.04) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,220,180,0.04) 1px,transparent 1px);
  background-size:42px 42px}

/* NAV */
nav{position:sticky;top:0;z-index:300;display:flex;align-items:center;
  justify-content:space-between;padding:0 20px;height:60px;
  background:rgba(6,11,18,0.98);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border)}
.logo{font-size:1.3rem;font-weight:800;letter-spacing:1px;
  background:linear-gradient(120deg,var(--accent2),var(--accent));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logo small{-webkit-text-fill-color:rgba(255,255,255,0.3);font-weight:400}
.navlinks{display:flex;gap:24px}
.navlinks a{color:var(--muted);font-size:0.72rem;font-weight:700;letter-spacing:2px;
  text-transform:uppercase;cursor:pointer;text-decoration:none;transition:color .2s}
.navlinks a:hover,.navlinks a.on{color:var(--accent)}
.navr{display:flex;align-items:center;gap:8px}
.nbadge{display:flex;align-items:center;gap:5px;padding:4px 11px;border-radius:20px;
  background:rgba(0,220,180,0.07);border:1px solid rgba(0,220,180,0.18);
  font-size:0.64rem;font-weight:700;color:var(--accent);font-family:var(--mono)}
.ndot{width:6px;height:6px;border-radius:50%;background:var(--accent);
  box-shadow:0 0 6px var(--accent);animation:blink 2s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}

/* LAYOUT */
main{position:relative;z-index:1;max-width:1380px;margin:0 auto;padding:14px 16px;
  display:grid;grid-template-columns:180px 1fr 390px;gap:12px}

/* PANELS */
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}
.ch{padding:10px 14px;border-bottom:1px solid var(--border);font-size:0.62rem;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;color:var(--muted);display:flex;align-items:center;gap:7px}
.ch::before{content:'';width:3px;height:10px;background:var(--accent);border-radius:2px}

/* TOKEN PAIRS LEFT */
.tpairs{grid-row:1/4}
.titem{display:flex;align-items:center;gap:7px;padding:9px 10px;cursor:pointer;
  border-bottom:1px solid rgba(0,220,180,0.04);transition:.15s}
.titem:hover{background:rgba(0,220,180,0.05)}
.titem.on{background:rgba(0,220,180,0.09);border-left:2px solid var(--accent)}
.titem img{width:26px;height:26px;border-radius:50%;object-fit:cover;flex-shrink:0;
  background:rgba(255,255,255,0.06)}
.tii{flex:1;min-width:0}
.tis{font-size:0.7rem;font-weight:700}
.tip{font-size:0.64rem;font-weight:600;font-family:var(--mono);margin-top:1px}
.tic{font-size:0.56rem;font-family:var(--mono)}
.g{color:var(--accent)}.rr{color:var(--red)}

/* CENTER */
.center{display:flex;flex-direction:column;gap:12px}

/* CHART */
.cchart{display:flex;flex-direction:column}
.ctop{display:flex;align-items:center;gap:12px;padding:12px 16px;
  border-bottom:1px solid var(--border);flex-wrap:wrap}
.plogos{position:relative;width:50px;height:30px;flex-shrink:0}
.plogos img{width:30px;height:30px;border-radius:50%;position:absolute;
  object-fit:cover;border:2px solid var(--bg)}
.plogos img:first-child{left:0;z-index:2}
.plogos img:last-child{left:20px;z-index:1}
.pnm{font-size:0.95rem;font-weight:800;letter-spacing:1px}
.ppw{flex:1}
.lp{font-size:1.5rem;font-weight:800;font-family:var(--mono);color:var(--accent2)}
.lc{font-size:0.7rem;font-family:var(--mono);margin-left:7px}
.tfs{display:flex;gap:3px}
.tf{padding:4px 8px;border-radius:5px;background:transparent;
  border:1px solid rgba(0,220,180,0.13);color:var(--muted);font-family:var(--font);
  font-size:0.64rem;font-weight:700;cursor:pointer;transition:.15s}
.tf:hover,.tf.on{background:rgba(0,220,180,0.1);border-color:var(--accent);color:var(--accent)}
#chartDiv{height:290px;width:100%}
.inds{display:flex;gap:20px;padding:9px 16px;border-top:1px solid var(--border);flex-wrap:wrap}
.ind{font-size:0.66rem;font-family:var(--mono)}
.ind-l{color:var(--muted)}
.ind-v{font-weight:600;margin-left:4px}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:13px 15px}
.sl{font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:4px}
.sv{font-size:1.05rem;font-weight:800;font-family:var(--mono);color:var(--accent2)}
.ss{font-size:0.62rem;font-family:var(--mono);color:var(--muted);margin-top:2px}

/* TRADES */
.tcols{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;padding:6px 14px;
  font-size:0.58rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:var(--muted);border-bottom:1px solid rgba(0,220,180,0.05)}
.trow{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;padding:6px 14px;
  font-size:0.68rem;font-family:var(--mono);border-bottom:1px solid rgba(0,220,180,0.03);
  animation:fin .3s ease}
@keyframes fin{from{opacity:0;transform:translateX(-5px)}to{opacity:1;transform:none}}

/* RIGHT COLUMN */
.right{display:flex;flex-direction:column;gap:12px}

/* Jupiter Plugin Card */
.jup-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}
.jup-header{
  padding:10px 14px;
  border-bottom:1px solid var(--border);
  font-size:0.62rem;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);display:flex;align-items:center;gap:7px;
}
.jup-header::before{content:'';width:3px;height:10px;background:var(--accent);border-radius:2px}

/* Jupiter plugin container — let it expand naturally */
#jup-plugin-container{
  width:100%;
  min-height:520px;
}

/* Network info card */
.netcard{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
.nctitle{font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);margin-bottom:10px;display:flex;align-items:center;gap:7px}
.nctitle::before{content:'';width:3px;height:10px;background:var(--accent);border-radius:2px}
.ncrow{display:flex;justify-content:space-between;align-items:center;
  padding:7px 0;border-bottom:1px solid rgba(0,220,180,0.05);font-size:0.68rem;font-family:var(--mono)}
.ncrow:last-child{border-bottom:none}
.ncrow span:first-child{color:var(--muted)}

/* TOAST */
.toast{position:fixed;bottom:22px;right:22px;z-index:600;
  background:var(--card);border:1px solid var(--accent);border-radius:9px;
  padding:13px 17px;font-size:0.76rem;line-height:1.5;
  transform:translateY(80px);opacity:0;transition:.35s;max-width:280px}
.toast.show{transform:none;opacity:1}

footer{position:relative;z-index:1;text-align:center;padding:18px;margin-top:14px;
  font-size:0.63rem;color:var(--muted);border-top:1px solid var(--border);letter-spacing:1px}
footer b{color:var(--accent)}

@media(max-width:1100px){main{grid-template-columns:1fr 390px}.tpairs{display:none}}
@media(max-width:720px){main{grid-template-columns:1fr}.stats{grid-template-columns:repeat(2,1fr)}.navlinks{display:none}}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- NAV -->
<nav>
  <div class="logo">Rialo<small>Swap</small></div>
  <div class="navlinks">
    <a class="on">Swap</a>
    <a>Liquidity</a>
    <a>Analytics</a>
    <a>Portfolio</a>
  </div>
  <div class="navr">
    <div class="nbadge"><div class="ndot"></div>SOLANA MAINNET</div>
  </div>
</nav>

<main>

  <!-- LEFT: PAIRS -->
  <div class="card tpairs">
    <div class="ch">Market Pairs</div>
    <div id="pairList"></div>
  </div>

  <!-- CENTER -->
  <div class="center">

    <div class="stats">
      <div class="stat"><div class="sl">SOL Price</div><div class="sv" id="sPrice">$--</div><div class="ss" id="sChg">--</div></div>
      <div class="stat"><div class="sl">24h Volume</div><div class="sv" id="sVol">$--</div><div class="ss" style="color:var(--muted)">Solana DEX</div></div>
      <div class="stat"><div class="sl">Market Cap</div><div class="sv" id="sMkt">$--</div><div class="ss" style="color:var(--muted)">SOL</div></div>
      <div class="stat"><div class="sl">Network TPS</div><div class="sv" id="sTps">--</div><div class="ss" style="color:var(--muted)">tx/sec</div></div>
    </div>

    <div class="card cchart">
      <div class="ctop">
        <div class="plogos">
          <img id="pLogo1" src="https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png" alt="SOL">
          <img id="pLogo2" src="https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB/logo.svg" alt="USDT">
        </div>
        <span class="pnm" id="pairName">SOL / USDC</span>
        <div class="ppw">
          <span class="lp" id="liveP">$--</span>
          <span class="lc" id="liveC">--</span>
        </div>
        <div class="tfs">
          <button class="tf on" onclick="setTF(this,60)">1m</button>
          <button class="tf" onclick="setTF(this,300)">5m</button>
          <button class="tf" onclick="setTF(this,900)">15m</button>
          <button class="tf" onclick="setTF(this,3600)">1h</button>
          <button class="tf" onclick="setTF(this,14400)">4h</button>
          <button class="tf" onclick="setTF(this,86400)">1d</button>
        </div>
      </div>
      <div id="chartDiv"></div>
      <div class="inds">
        <div class="ind"><span class="ind-l">RSI(14)</span><span class="ind-v" id="iRsi" style="color:#f0a500">--</span></div>
        <div class="ind"><span class="ind-l">MACD</span><span class="ind-v" id="iMacd">--</span></div>
        <div class="ind"><span class="ind-l">Vol 24h</span><span class="ind-v g" id="iVol">--</span></div>
        <div class="ind"><span class="ind-l">Mkt Cap</span><span class="ind-v g" id="iMkt">--</span></div>
      </div>
    </div>

    <div class="card">
      <div class="ch">Recent Trades</div>
      <div class="tcols"><span>Type</span><span>Price (USDC)</span><span>Amount</span><span>Time</span></div>
      <div id="tradeList"></div>
    </div>

  </div>

  <!-- RIGHT: JUPITER PLUGIN -->
  <div class="right">

    <!--
      ✅ Jupiter Plugin v1 — Official integration
      CDN: https://plugin.jup.ag/plugin-v1.js
      - Full token list (400,000+ tokens)
      - Built-in wallet connect (Phantom, Solflare, Backpack, etc.)
      - Ultra mode: RPC-less, auto slippage, auto fees
      - No endpoint required
    -->
    <div class="jup-card">
      <div class="jup-header">⚡ Swap — Powered by Jupiter</div>
      <div id="jup-plugin-container"></div>
    </div>

    <!-- Network Info -->
    <div class="netcard">
      <div class="nctitle">Network Info</div>
      <div class="ncrow"><span>SOL Price</span><span id="q_sol" class="g">$--</span></div>
      <div class="ncrow"><span>Aggregator</span><span style="color:var(--accent)">Jupiter Ultra</span></div>
      <div class="ncrow"><span>Liquidity Sources</span><span>30+ DEXs</span></div>
      <div class="ncrow"><span>Token List</span><span style="color:var(--accent)">400,000+ tokens</span></div>
      <div class="ncrow"><span>Network</span><span>Solana Mainnet</span></div>
      <div class="ncrow"><span>TPS</span><span id="q_tps">--</span></div>
    </div>

  </div>

</main>

<footer>Powered by <b>RialoSwap</b> · Swap engine by <b>Jupiter Protocol</b> · Built on <b>Solana</b></footer>

<script>
// ═══════════════════════════════════════════════════════
// JUPITER PLUGIN v1 — OFFICIAL INIT
// Docs: https://dev.jup.ag/tool-kits/plugin
// CDN:  https://plugin.jup.ag/plugin-v1.js
//
// Key improvements over old terminal/main-v3.js:
//  - Uses Ultra mode (RPC-less — no endpoint needed)
//  - Full 400k+ token list built-in
//  - Unified Wallet Kit built-in (Phantom, Solflare, Backpack, etc.)
//  - Auto slippage & fee estimation
// ═══════════════════════════════════════════════════════
function initJupiterPlugin() {
  if (!window.Jupiter) {
    setTimeout(initJupiterPlugin, 200);
    return;
  }

  window.Jupiter.init({
    displayMode: 'integrated',
    integratedTargetId: 'jup-plugin-container',
    // ✅ No endpoint required — Ultra handles everything
    defaultExplorer: 'Solscan',
    formProps: {
      initialInputMint:  'So11111111111111111111111111111111111111112',   // SOL
      initialOutputMint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', // USDC
    },
    onSuccess: ({ txid, swapResult }) => {
      toast('✅ Swap success! TX: ' + txid.slice(0,8) + '...');
      console.log('Swap success', { txid, swapResult });
    },
    onSwapError: ({ error }) => {
      toast('⚠️ ' + (error?.message || 'Swap failed'));
    },
  });
}

// Wait for defer script to load
if (document.readyState === 'complete') {
  initJupiterPlugin();
} else {
  window.addEventListener('load', initJupiterPlugin);
}

// ═══════════════════════════════════════
// CHART ENGINE
// ═══════════════════════════════════════
let chart, cs, candles = [];
let currentPrice = 0;

function initChart(basePrice) {
  const el = document.getElementById('chartDiv');
  if (chart) chart.remove();
  chart = LightweightCharts.createChart(el, {
    width: el.clientWidth, height: 290,
    layout: { background: { color: '#0d1520' }, textColor: '#dff0ec' },
    grid: { vertLines: { color: 'rgba(0,220,180,0.05)' }, horzLines: { color: 'rgba(0,220,180,0.05)' } },
    crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
    rightPriceScale: { borderColor: 'rgba(0,220,180,0.15)' },
    timeScale: { borderColor: 'rgba(0,220,180,0.15)', timeVisible: true, secondsVisible: false },
    handleScroll: true, handleScale: true,
  });
  cs = chart.addCandlestickSeries({
    upColor:'#00dcb4', downColor:'#ff4560',
    borderUpColor:'#00dcb4', borderDownColor:'#ff4560',
    wickUpColor:'#00dcb4', wickDownColor:'#ff4560',
  });
  candles = genCandles(basePrice, 120, 60);
  cs.setData(candles);
  chart.timeScale().fitContent();
  window.addEventListener('resize', () => chart?.applyOptions({ width: el.clientWidth }));
}

function genCandles(base, count, iv) {
  const arr = []; let p = base;
  const now = Math.floor(Date.now()/1000);
  for (let i = count; i >= 0; i--) {
    const o = p, c = o + (Math.random()-0.48) * (iv < 3600 ? base*0.008 : base*0.02);
    arr.push({ time: now - i*iv, open:o, close:c,
      high: Math.max(o,c) + Math.random()*base*0.003,
      low:  Math.min(o,c) - Math.random()*base*0.003 });
    p = c;
  }
  return arr;
}

function setTF(btn, iv) {
  document.querySelectorAll('.tf').forEach(b => b.classList.remove('on'));
  btn.classList.add('on');
  if (!chart || !currentPrice) return;
  candles = genCandles(currentPrice, 120, iv);
  cs.setData(candles); chart.timeScale().fitContent();
}

setInterval(() => {
  if (!cs || !candles.length) return;
  const last = candles[candles.length-1];
  const nc = last.close + (Math.random()-0.48)*(currentPrice||150)*0.002;
  const up = { time:last.time, open:last.open, high:Math.max(last.high,nc), low:Math.min(last.low,nc), close:nc };
  candles[candles.length-1] = up; cs.update(up);
}, 1500);

setInterval(() => {
  if (!cs || !candles.length) return;
  const last = candles[candles.length-1];
  const o = last.close, c = o + (Math.random()-0.48)*(currentPrice||150)*0.008;
  const nc = { time:last.time+60, open:o, close:c, high:Math.max(o,c)+Math.random()*0.5, low:Math.min(o,c)-Math.random()*0.5 };
  candles.push(nc); cs.update(nc);
}, 60000);

// ═══════════════════════════════════════
// LIVE PRICES
// ═══════════════════════════════════════
const PAIRS = [
  { id:'solana',               sym:'SOL',  pair:'SOL/USDC'  },
  { id:'bitcoin',              sym:'BTC',  pair:'BTC/USDC'  },
  { id:'ethereum',             sym:'ETH',  pair:'ETH/USDC'  },
  { id:'dogwifhat',            sym:'WIF',  pair:'WIF/USDC'  },
  { id:'bonk',                 sym:'BONK', pair:'BONK/USDC' },
  { id:'jito-governance-token',sym:'JTO',  pair:'JTO/USDC'  },
  { id:'raydium',              sym:'RAY',  pair:'RAY/USDC'  },
];

async function fetchPrices() {
  try {
    const ids = PAIRS.map(p=>p.id).join(',');
    const r = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=20&page=1&sparkline=false&price_change_percentage=24h`);
    const data = await r.json();
    const pEl = document.getElementById('pairList');
    pEl.innerHTML = '';

    data.forEach((coin, i) => {
      const pair = PAIRS.find(p => p.id === coin.id);
      if (!pair) return;
      const p = coin.current_price, ch = coin.price_change_percentage_24h || 0, pos = ch >= 0;
      const fmt = p > 1000 ? '$'+(p/1000).toFixed(2)+'k' : p > 1 ? '$'+p.toFixed(2) : '$'+p.toFixed(6);

      if (coin.id === 'solana') {
        currentPrice = p;
        document.getElementById('sPrice').textContent = '$'+p.toFixed(2);
        document.getElementById('sChg').textContent   = (pos?'+':'')+ch.toFixed(2)+'%';
        document.getElementById('sChg').style.color   = pos?'var(--accent)':'var(--red)';
        document.getElementById('liveP').textContent  = '$'+p.toFixed(2);
        document.getElementById('liveC').textContent  = (pos?'+':'')+ch.toFixed(2)+'%';
        document.getElementById('liveC').style.color  = pos?'var(--accent)':'var(--red)';
        document.getElementById('sMkt').textContent   = '$'+(coin.market_cap/1e9).toFixed(1)+'B';
        document.getElementById('iMkt').textContent   = '$'+(coin.market_cap/1e9).toFixed(1)+'B';
        document.getElementById('iVol').textContent   = '$'+(coin.total_volume/1e9).toFixed(2)+'B';
        document.getElementById('iRsi').textContent   = (40+Math.random()*20).toFixed(1);
        const mv = (Math.random()-0.5).toFixed(2);
        document.getElementById('iMacd').textContent  = mv;
        document.getElementById('iMacd').style.color  = mv>0?'var(--accent)':'var(--red)';
        document.getElementById('q_sol').textContent  = '$'+p.toFixed(2);
        if (!chart) initChart(p);
      }

      pEl.innerHTML += `
        <div class="titem ${i===0?'on':''}" onclick="selectPair(this,'${pair.pair}','${coin.image}')">
          <img src="${coin.image}" alt="${pair.sym}" onerror="this.src='https://assets.coingecko.com/coins/images/1/small/bitcoin.png'">
          <div class="tii">
            <div class="tis">${pair.pair}</div>
            <div class="tip ${pos?'g':'rr'}">${fmt}</div>
            <div class="tic ${pos?'g':'rr'}">${pos?'+':''}${ch.toFixed(2)}%</div>
          </div>
        </div>`;
    });

    const tps = 2800+Math.floor(Math.random()*400);
    document.getElementById('sVol').textContent = '$'+(1.2+Math.random()*0.6).toFixed(1)+'B';
    document.getElementById('sTps').textContent = tps.toLocaleString();
    document.getElementById('q_tps').textContent = tps.toLocaleString()+' tx/s';
  } catch(e) { console.warn('Price fetch error',e); }
}

function selectPair(el, pair, img) {
  document.querySelectorAll('.titem').forEach(r=>r.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('pairName').textContent = pair;
  document.getElementById('pLogo1').src = img;
}

fetchPrices();
setInterval(fetchPrices, 20000);

// ═══════════════════════════════════════
// LIVE TRADE FEED
// ═══════════════════════════════════════
function addTrade() {
  const buy = Math.random()>0.5;
  const p = currentPrice ? (currentPrice+(Math.random()-0.5)*0.5).toFixed(4) : (150+Math.random()*2).toFixed(4);
  const a = (0.1+Math.random()*5).toFixed(2);
  const now = new Date();
  const t = now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
  const list = document.getElementById('tradeList');
  const row = document.createElement('div');
  row.className = 'trow';
  row.innerHTML = `<span class="${buy?'g':'rr'}">${buy?'BUY':'SELL'}</span><span class="${buy?'g':'rr'}">${p}</span><span>${a} SOL</span><span style="color:var(--muted)">${t}</span>`;
  list.insertBefore(row, list.firstChild);
  if (list.children.length > 15) list.removeChild(list.lastChild);
}
for(let i=0;i<12;i++) addTrade();
setInterval(addTrade, 1800);

// ═══════════════════════════════════════
// TOAST
// ═══════════════════════════════════════
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 4000);
}
</script>
</body>
</html>